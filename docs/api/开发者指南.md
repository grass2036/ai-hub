# AI Hub Platform 开发者指南

> 为开发者提供的完整API使用指南和最佳实践

## 🚀 快速开始

### 1. 获取API密钥

1. 注册开发者账户：`POST /api/v1/developer/auth/register`
2. 登录获取访问令牌：`POST /api/v1/developer/auth/login`
3. 创建API密钥：`POST /api/v1/developer/keys/keys`

### 2. 认证API请求

所有API请求都需要通过API密钥进行认证：

```bash
# 方法1: Authorization Header (推荐)
curl -H "Authorization: Bearer your_api_key_here" \
     https://api.aihub.com/api/v1/chat/completions

# 方法2: X-API-Key Header
curl -H "X-API-Key: your_api_key_here" \
     https://api.aihub.com/api/v1/chat/completions

# 方法3: 查询参数
curl "https://api.aihub.com/api/v1/chat/completions?api_key=your_api_key_here"
```

## 📋 API端点概览

### 核心功能

| 端点 | 方法 | 描述 | 认证 |
|------|------|------|------|
| `/chat/completions` | POST | 对话完成 | API Key |
| `/chat/models` | GET | 获取模型列表 | API Key |
| `/chat/stream` | POST | 流式对话 | API Key |

### 开发者管理

| 端点 | 方法 | 描述 | 认证 |
|------|------|------|------|
| `/developer/auth/register` | POST | 注册开发者 | None |
| `/developer/auth/login` | POST | 开发者登录 | None |
| `/developer/keys/keys` | POST | 创建API密钥 | JWT |
| `/developer/keys/keys` | GET | 获取API密钥列表 | JWT |
| `/developer/keys/quota` | GET | 查看使用配额 | JWT |

### 支付和订阅

| 端点 | 方法 | 描述 | 认证 |
|------|------|------|------|
| `/payments/plans` | GET | 获取订阅套餐 | JWT |
| `/payments/subscriptions` | POST | 创建订阅 | JWT |
| `/payments/invoices` | GET | 获取发票列表 | JWT |

## 💬 对话API

### 创建对话完成

```http
POST /api/v1/chat/completions
Authorization: Bearer your_api_key_here
Content-Type: application/json

{
  "model": "gpt-4o-mini",
  "messages": [
    {
      "role": "user",
      "content": "你好，请介绍一下你自己"
    }
  ],
  "temperature": 0.7,
  "max_tokens": 1000
}
```

**响应示例：**
```json
{
  "success": true,
  "data": {
    "id": "chat_123456789",
    "object": "chat.completion",
    "created": 1703112345,
    "model": "gpt-4o-mini",
    "choices": [
      {
        "index": 0,
        "message": {
          "role": "assistant",
          "content": "你好！我是AI Hub平台的AI助手..."
        },
        "finish_reason": "stop"
      }
    ],
    "usage": {
      "prompt_tokens": 15,
      "completion_tokens": 42,
      "total_tokens": 57
    },
    "cost": 0.00000855
  }
}
```

### 流式对话

```http
POST /api/v1/chat/stream
Authorization: Bearer your_api_key_here
Content-Type: application/json

{
  "model": "gpt-4o-mini",
  "messages": [
    {
      "role": "user",
      "content": "请写一首关于春天的诗"
    }
  ],
  "stream": true
}
```

**流式响应：**
```
data: {"id": "chat_123", "choices": [{"delta": {"content": "春"}}]}
data: {"id": "chat_123", "choices": [{"delta": {"content": "天"}}]}
data: {"id": "chat_123", "choices": [{"delta": {"content": "来"}}]}
data: {"id": "chat_123", "choices": [{"delta": {"content": "了"}}]}
data: [DONE]
```

### 参数说明

| 参数 | 类型 | 必需 | 描述 |
|------|------|------|------|
| model | string | ✅ | 要使用的模型ID |
| messages | array | ✅ | 对话消息数组 |
| temperature | number | ❌ | 控制输出随机性 (0-1) |
| max_tokens | integer | ❌ | 最大生成token数 |
| stream | boolean | ❌ | 是否启用流式响应 |
| top_p | number | ❌ | 核采样参数 |
| frequency_penalty | number | ❌ | 频率惩罚 (-2 to 2) |
| presence_penalty | number | ❌ | 存在惩罚 (-2 to 2) |

## 🔧 可用模型

### 基础模型 (所有开发者可用)

| 模型ID | 名称 | 描述 | 价格 |
|--------|------|------|------|
| `gpt-4o-mini` | GPT-4o Mini | 轻量级GPT-4o模型 | $0.00015/1K tokens |
| `llama-3.1-70b` | Llama 3.1 70B | Meta开源的高性能模型 | $0.001/1K tokens |

### 高级模型 (付费用户可用)

| 模型ID | 名称 | 描述 | 价格 |
|--------|------|------|------|
| `gpt-4o` | GPT-4o | OpenAI最新旗舰模型 | $0.015/1K tokens |
| `claude-3.5-sonnet` | Claude 3.5 Sonnet | Anthropic高性能模型 | $0.003/1K tokens |
| `gemini-1.5-pro` | Gemini 1.5 Pro | Google多模态大模型 | $0.0025/1K tokens |

### 免费模型

| 模型ID | 名称 | 描述 | 价格 |
|--------|------|------|------|
| `grok-4-fast:free` | Grok 4 Fast | xAI快速响应模型 | 免费 |
| `deepseek-chat-v3.1:free` | DeepSeek Chat V3.1 | 深度求索对话模型 | 免费 |

## 📊 使用统计

### 查看配额信息

```http
GET /api/v1/developer/keys/quota
Authorization: Bearer your_jwt_token_here
```

**响应示例：**
```json
{
  "success": true,
  "data": {
    "monthly_quota": 1000000,
    "monthly_used": 45320,
    "monthly_remaining": 954680,
    "monthly_usage_percent": 4.53,
    "monthly_cost": 6.85,
    "active_api_keys": 3,
    "max_api_keys": 10,
    "reset_date": "2025-02-01"
  }
}
```

### 获取API密钥使用统计

```http
GET /api/v1/developer/keys/keys/{key_id}/usage?days=30
Authorization: Bearer your_jwt_token_here
```

**响应示例：**
```json
{
  "success": true,
  "data": {
    "period_days": 30,
    "total_requests": 1250,
    "total_tokens": 45320,
    "total_cost": 6.85,
    "avg_response_time": 845.5,
    "success_rate": 99.2,
    "model_usage": {
      "gpt-4o-mini": {
        "requests": 800,
        "tokens": 28000,
        "cost": 4.20
      },
      "llama-3.1-70b": {
        "requests": 450,
        "tokens": 17320,
        "cost": 2.65
      }
    },
    "daily_usage": {
      "2025-01-15": {
        "requests": 45,
        "tokens": 1620,
        "cost": 0.24
      }
    }
  }
}
```

## 🚨 错误处理

### 错误响应格式

所有API错误都遵循统一格式：

```json
{
  "success": false,
  "error": {
    "type": "invalid_request_error",
    "message": "API密钥无效",
    "code": "invalid_api_key",
    "details": {
      "hint": "请检查API密钥是否正确，或联系支持"
    }
  }
}
```

### 常见错误码

| HTTP状态码 | 错误类型 | 描述 | 解决方案 |
|------------|----------|------|----------|
| 401 | `authentication_error` | 认证失败 | 检查API密钥 |
| 403 | `permission_error` | 权限不足 | 检查订阅状态 |
| 429 | `rate_limit_error` | 速率限制 | 等待后重试 |
| 400 | `invalid_request_error` | 请求参数错误 | 检查请求格式 |
| 500 | `server_error` | 服务器错误 | 稍后重试或联系支持 |

### 使用限制

- **速率限制**: 根据订阅计划不同，每分钟10-1000次请求
- **令牌限制**: 根据订阅计划不同，每月10K-10M tokens
- **并发限制**: 每个API密钥最多10个并发请求

## 🔒 安全最佳实践

### API密钥管理

1. **环境变量存储**: 不要在代码中硬编码API密钥
   ```python
   import os
   API_KEY = os.getenv('AIHUB_API_KEY')
   ```

2. **密钥轮换**: 定期更换API密钥
3. **最小权限**: 为不同应用创建不同的API密钥
4. **监控使用**: 定期检查使用统计，发现异常及时处理

### 请求安全

1. **HTTPS**: 所有API请求必须使用HTTPS
2. **输入验证**: 对用户输入进行验证和清理
3. **错误处理**: 妥善处理API错误，不要暴露敏感信息

## 💡 代码示例

### Python示例

```python
import requests
import json

class AIHubClient:
    def __init__(self, api_key):
        self.api_key = api_key
        self.base_url = "https://api.aihub.com/api/v1"
        self.headers = {
            "Authorization": f"Bearer {api_key}",
            "Content-Type": "application/json"
        }

    def chat_completion(self, messages, model="gpt-4o-mini", **kwargs):
        """创建对话完成"""
        data = {
            "model": model,
            "messages": messages,
            **kwargs
        }

        response = requests.post(
            f"{self.base_url}/chat/completions",
            headers=self.headers,
            json=data
        )

        if response.status_code == 200:
            return response.json()
        else:
            raise Exception(f"API错误: {response.status_code} - {response.text}")

    def chat_stream(self, messages, model="gpt-4o-mini", **kwargs):
        """流式对话"""
        data = {
            "model": model,
            "messages": messages,
            "stream": True,
            **kwargs
        }

        response = requests.post(
            f"{self.base_url}/chat/stream",
            headers=self.headers,
            json=data,
            stream=True
        )

        for line in response.iter_lines():
            if line:
                line = line.decode('utf-8')
                if line.startswith('data: '):
                    data = line[6:]
                    if data == '[DONE]':
                        break
                    yield json.loads(data)

# 使用示例
client = AIHubClient("your_api_key_here")

# 普通对话
response = client.chat_completion([
    {"role": "user", "content": "你好！"}
])
print(response["data"]["choices"][0]["message"]["content"])

# 流式对话
for chunk in client.chat_stream([
    {"role": "user", "content": "请写一首诗"}
]):
    if chunk.get("choices"):
        content = chunk["choices"][0].get("delta", {}).get("content", "")
        print(content, end="", flush=True)
```

### JavaScript示例

```javascript
class AIHubClient {
    constructor(apiKey) {
        this.apiKey = apiKey;
        this.baseURL = 'https://api.aihub.com/api/v1';
        this.headers = {
            'Authorization': `Bearer ${apiKey}`,
            'Content-Type': 'application/json'
        };
    }

    async chatCompletion(messages, model = 'gpt-4o-mini', options = {}) {
        const response = await fetch(`${this.baseURL}/chat/completions`, {
            method: 'POST',
            headers: this.headers,
            body: JSON.stringify({
                model,
                messages,
                ...options
            })
        });

        if (!response.ok) {
            const error = await response.json();
            throw new Error(`API错误: ${response.status} - ${error.error?.message}`);
        }

        return await response.json();
    }

    async *chatStream(messages, model = 'gpt-4o-mini', options = {}) {
        const response = await fetch(`${this.baseURL}/chat/stream`, {
            method: 'POST',
            headers: this.headers,
            body: JSON.stringify({
                model,
                messages,
                stream: true,
                ...options
            })
        });

        if (!response.ok) {
            const error = await response.json();
            throw new Error(`API错误: ${response.status} - ${error.error?.message}`);
        }

        const reader = response.body.getReader();
        const decoder = new TextDecoder();

        while (true) {
            const { done, value } = await reader.read();
            if (done) break;

            const chunk = decoder.decode(value);
            const lines = chunk.split('\n');

            for (const line of lines) {
                if (line.startsWith('data: ')) {
                    const data = line.slice(6);
                    if (data === '[DONE]') return;
                    try {
                        yield JSON.parse(data);
                    } catch (e) {
                        // 忽略解析错误
                    }
                }
            }
        }
    }
}

// 使用示例
const client = new AIHubClient('your_api_key_here');

// 普通对话
const response = await client.chatCompletion([
    { role: 'user', content: '你好！' }
]);
console.log(response.data.choices[0].message.content);

// 流式对话
for await (const chunk of client.chatStream([
    { role: 'user', content: '请写一首诗' }
])) {
    if (chunk.choices?.[0]?.delta?.content) {
        process.stdout.write(chunk.choices[0].delta.content);
    }
}
```

## 🆘 支持和帮助

### 获取帮助

- **文档**: https://docs.aihub.com
- **支持邮箱**: support@aihub.com
- **状态页面**: https://status.aihub.com
- **开发者社区**: https://community.aihub.com

### 常见问题

**Q: 如何提高API请求速率限制？**
A: 升级到更高级的订阅计划或联系销售团队定制方案。

**Q: 支持哪些编程语言？**
A: 支持所有能发送HTTP请求的编程语言，我们提供Python和JavaScript SDK。

**Q: 如何监控API使用情况？**
A: 使用开发者控制面板或调用统计API查看详细的使用数据。

**Q: 数据是否安全？**
A: 所有数据都通过HTTPS加密传输，我们不会存储您的对话内容。

---

© 2025 AI Hub Platform. 保留所有权利。