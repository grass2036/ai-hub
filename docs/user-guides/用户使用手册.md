# AI Hub 平台用户手册

## 目录

1. [平台简介](#平台简介)
2. [快速开始](#快速开始)
3. [功能详解](#功能详解)
4. [使用技巧](#使用技巧)
5. [常见问题](#常见问题)
6. [故障排除](#故障排除)

## 平台简介

AI Hub 是一个企业级 AI 应用平台，聚合了多个 AI 模型（通过 OpenRouter 支持 140+ 模型），提供流式响应、成本跟踪和会话管理功能。我们的目标是为开发者、企业和个人用户提供统一的 AI API 服务。

### 主要特性

- **多模型支持**: 访问 140+ AI 模型，包括 GPT-4、Claude、Gemini 等
- **智能路由**: 自动选择最优模型，提供智能回退机制
- **实时流式**: 支持实时流式响应，提升用户体验
- **成本跟踪**: 精确的费用计算和使用分析
- **会话管理**: 完整的对话历史和上下文管理
- **批处理**: 支持批量处理多个任务
- **监控分析**: 全面的系统监控和使用分析

### 适用场景

- **内容创作**: 博客文章、营销文案、产品描述
- **代码开发**: 代码生成、调试、优化建议
- **数据分析**: 数据解释、报告生成、洞察发现
- **客户服务**: 智能客服、问答机器人
- **教育培训**: 个性化学习、知识解答

## 快速开始

### 注册账户

1. 访问 [AI Hub 官网](https://aihub.com)
2. 点击"注册"按钮
3. 填写注册信息（邮箱、密码、姓名）
4. 验证邮箱地址
5. 完成注册并登录

### 首次使用

1. **登录仪表板**: 使用注册的邮箱和密码登录
2. **获取 API 密钥**:
   - 进入"API 密钥"页面
   - 点击"创建新密钥"
   - 设置密钥名称和权限
   - 复制并妥善保存密钥
3. **测试连接**: 使用提供的示例代码测试 API 连接

### 基础聊天

```bash
# 使用 cURL 测试基本聊天功能
curl -X POST "https://api.aihub.com/api/v1/chat/completions" \
  -H "Authorization: Bearer your_api_key" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "你好，请介绍一下你自己",
    "model": "gpt-4o-mini"
  }'
```

## 功能详解

### 聊天对话

#### 基础对话

AI Hub 提供简单易用的聊天接口，支持单轮和多轮对话。

**请求参数**:
- `message`: 您的消息内容
- `model`: 选择的 AI 模型
- `session_id`: 会话标识符（可选，用于多轮对话）
- `temperature`: 回复创造性（0-1，默认 0.7）
- `max_tokens`: 最大回复长度

**示例请求**:
```json
{
  "message": "请解释什么是机器学习",
  "model": "gpt-4o",
  "temperature": 0.7,
  "max_tokens": 500
}
```

#### 流式对话

对于长文本回复，建议使用流式接口获得更好的用户体验。

```javascript
// JavaScript 流式示例
const response = await fetch('/api/v1/chat/stream', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer your_api_key',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    message: '请详细解释量子计算的原理',
    model: 'gpt-4o'
  })
});

const reader = response.body.getReader();
const decoder = new TextDecoder();

while (true) {
  const { done, value } = await reader.read();
  if (done) break;

  const chunk = decoder.decode(value);
  const lines = chunk.split('\n');

  for (const line of lines) {
    if (line.startsWith('data: ')) {
      const data = JSON.parse(line.slice(6));
      if (data.type === 'chunk') {
        console.log(data.content);
      }
    }
  }
}
```

### 会话管理

会话管理功能帮助您维护对话上下文，实现连续的多轮对话。

#### 创建会话

```python
# Python 创建会话示例
import requests

headers = {
    'Authorization': 'Bearer your_api_key',
    'Content-Type': 'application/json'
}

data = {
    'title': 'AI 学习助手对话',
    'model': 'gpt-4o-mini'
}

response = requests.post(
    'https://api.aihub.com/api/v1/sessions',
    headers=headers,
    json=data
)

session = response.json()['data']
session_id = session['session_id']
print(f"会话已创建: {session_id}")
```

#### 继续对话

```python
# 在已有会话中继续对话
def continue_conversation(session_id, message):
    data = {
        'message': message,
        'model': 'gpt-4o-mini',
        'session_id': session_id
    }

    response = requests.post(
        'https://api.aihub.com/api/v1/chat/completions',
        headers=headers,
        json=data
    )

    return response.json()['data']['content']

# 示例对话流程
session_id = "your_session_id"

response1 = continue_conversation(session_id, "我想学习机器学习")
print(f"AI: {response1}")

response2 = continue_conversation(session_id, "能推荐一些入门课程吗？")
print(f"AI: {response2}")
```

#### 查看会话历史

```python
# 获取会话详细历史
response = requests.get(
    f'https://api.aihub.com/api/v1/sessions/{session_id}',
    headers=headers
)

session_data = response.json()['data']
print(f"会话标题: {session_data['title']}")
print(f"消息总数: {session_data['message_count']}")
print(f"总费用: ${session_data['estimated_cost']:.4f}")

print("\n对话历史:")
for msg in session_data['messages']:
    role = "用户" if msg['role'] == 'user' else "AI"
    print(f"{role}: {msg['content']}")
```

### 模型选择

AI Hub 支持多种 AI 模型，每个模型都有其独特的优势。

#### 查看可用模型

```python
# 获取所有可用模型
response = requests.get(
    'https://api.aihub.com/api/v1/models',
    headers=headers
)

models = response.json()['data']
print("可用模型:")
for model in models:
    print(f"- {model['name']} ({model['id']})")
    print(f"  提供商: {model['provider']}")
    print(f"  上下文长度: {model['context_length']:,}")
    print(f"  输入价格: ${model['pricing']['input']}/1K tokens")
    print(f"  输出价格: ${model['pricing']['output']}/1K tokens")
    print(f"  免费模型: {'是' if model['is_free'] else '否'}")
    print()
```

#### 模型推荐

**免费模型（适合学习和测试）**:
- `gpt-4o-mini`: 性能优秀，成本效益高
- `deepseek-chat-v3.1:free`: 深度求索免费模型
- `grok-4-fast:free`: Grok 快速免费版本

**付费模型（适合专业应用）**:
- `gpt-4o`: 最先进的综合模型
- `claude-3-5-sonnet`: 强大的分析和写作能力
- `gemini-1.5-pro`: Google 最新多模态模型

### 批处理功能

当您需要处理大量相似任务时，批处理功能可以显著提高效率。

#### 创建批处理任务

```python
# 创建批处理作业
batch_data = {
    'name': '产品描述生成任务',
    'model': 'gpt-4o-mini',
    'prompts': [
        '为 iPhone 15 Pro 编写产品描述',
        '为 MacBook Air M3 编写产品描述',
        '为 AirPods Pro 编写产品描述',
        '为 Apple Watch 编写产品描述'
    ],
    'max_concurrent_tasks': 3,
    'temperature': 0.7,
    'max_tokens': 300
}

response = requests.post(
    'https://api.aihub.com/api/v1/batch/generation',
    headers=headers,
    json=batch_data
)

job = response.json()['data']
job_id = job['job_id']
print(f"批处理任务已创建: {job_id}")
print(f"总任务数: {job['total_tasks']}")
```

#### 检查任务状态

```python
# 检查批处理任务状态
def check_job_status(job_id):
    response = requests.get(
        f'https://api.aihub.com/api/v1/batch/jobs/{job_id}',
        headers=headers
    )

    job_data = response.json()['data']
    print(f"任务名称: {job_data['name']}")
    print(f"状态: {job_data['status']}")
    print(f"进度: {job_data['progress']['progress_percentage']}%")
    print(f"已完成: {job_data['progress']['completed_tasks']}")
    print(f"失败: {job_data['progress']['failed_tasks']}")

    if job_data['status'] == 'completed':
        print("\n任务结果:")
        for result in job_data['results']:
            print(f"任务 {result['task_id']}: {result['prompt'][:50]}...")
            print(f"结果: {result['result'][:100]}...")
            print(f"费用: ${result['cost']:.4f}")
            print()

    return job_data

# 定期检查状态
import time
while True:
    job_data = check_job_status(job_id)
    if job_data['status'] in ['completed', 'failed']:
        break
    time.sleep(10)  # 每 10 秒检查一次
```

### 使用统计

了解您的 API 使用情况对于成本控制和优化非常重要。

#### 使用概览

```python
# 获取使用概览
response = requests.get(
    'https://api.aihub.com/api/v1/usage/overview?days=30',
    headers=headers
)

usage = response.json()['data']
print("使用概览（过去 30 天）:")
print(f"总请求数: {usage['total_requests']:,}")
print(f"总 Tokens: {usage['total_tokens']:,}")
print(f"总费用: ${usage['total_cost']:.2f}")
print(f"平均每次请求 Tokens: {usage['average_request_tokens']}")
print(f"平均每次请求费用: ${usage['total_cost']/usage['total_requests']:.4f}")

print("\n最常用模型:")
for model in usage['top_models']:
    print(f"- {model['model']}: {model['requests']} 次请求")
    print(f"  Tokens: {model['tokens']:,}")
    print(f"  费用: ${model['cost']:.2f}")
```

#### 详细分析

```python
# 获取详细使用分析
response = requests.get(
    'https://api.aihub.com/api/v1/usage/analytics?days=7',
    headers=headers
)

analytics = response.json()['data']

print("使用趋势分析:")
print("模型使用分布:")
for model, percentage in analytics['model_distribution'].items():
    print(f"- {model}: {percentage:.1f}%")

print(f"\n成本分析:")
print(f"总费用: ${analytics['cost_analysis']['total_cost']:.2f}")
print(f"平均费用/请求: ${analytics['cost_analysis']['average_cost_per_request']:.4f}")
print(f"费用趋势: {analytics['cost_analysis']['cost_trend']}")
```

## 使用技巧

### 成本优化

1. **选择合适的模型**
   - 开发和测试使用免费模型
   - 简单任务使用小型模型
   - 复杂任务才使用高级模型

2. **控制回复长度**
   ```python
   # 设置合理的 max_tokens
   response = client.chat.completions.create(
       message="简单回答这个问题",
       model="gpt-4o-mini",
       max_tokens=150  # 限制回复长度
   )
   ```

3. **使用会话上下文**
   - 相关问题在同一会话中提问
   - 避免重复的上下文说明
   - 定期清理不需要的会话

### 性能优化

1. **使用流式响应**
   - 长文本使用流式接口
   - 提升用户等待体验
   - 减少服务器内存占用

2. **合理设置并发**
   ```python
   # 批处理时设置合适的并发数
   batch_data = {
       'prompts': [...],
       'max_concurrent_tasks': 5,  # 根据需求调整
   }
   ```

3. **缓存常用结果**
   - 相同问题可以缓存结果
   - 减少重复 API 调用
   - 注意数据时效性

### 提示词优化

1. **清晰明确的指令**
   ```
   好的提示: "请用3个要点总结机器学习的核心概念"
   不好的提示: "机器学习"
   ```

2. **提供上下文信息**
   ```
   好的提示: "我是一名初学者，请用简单的语言解释什么是过拟合"
   不好的提示: "解释过拟合"
   ```

3. **指定输出格式**
   ```
   好的提示: "请以JSON格式返回产品分析的3个关键指标"
   不好的提示: "分析这个产品"
   ```

## 常见问题

### API 使用相关

**Q: 如何获取 API 密钥？**
A: 登录 AI Hub 仪表板，进入"API 密钥"页面，点击"创建新密钥"即可。

**Q: API 密钥有权限控制吗？**
A: 是的，您可以为每个 API 密钥设置特定权限（chat、usage、batch、monitoring）。

**Q: 如何限制 API 密钥的使用？**
A: 创建密钥时可以设置速率限制，包括每分钟请求数和 token 数。

**Q: API 调用失败怎么办？**
A: 首先检查网络连接和 API 密钥是否正确，然后查看错误码和错误信息进行排查。

### 费用相关

**Q: 如何查看我的使用费用？**
A: 在仪表板的"使用统计"页面可以查看详细的使用情况和费用分析。

**Q: 可以设置费用提醒吗？**
A: 是的，在"设置"页面可以配置费用提醒和限额。

**Q: 免费模型有哪些限制？**
A: 免费模型可能有速率限制和并发限制，适合开发测试使用。

**Q: 如何优化使用成本？**
A: 选择合适的模型、控制回复长度、使用会话上下文、设置合理的并发数。

### 技术问题

**Q: 流式响应如何处理断线？**
A: 实现自动重连机制，从上次接收的位置继续请求。

**Q: 会话数据会保存多久？**
A: 会话数据默认保存 30 天，可以在设置中调整保存期限。

**Q: 支持哪些编程语言？**
A: 提供 Python 和 JavaScript 官方 SDK，其他语言可以通过 REST API 使用。

**Q: 如何处理大文件上传？**
A: 目前支持文本输入，大文件处理功能正在开发中。

## 故障排除

### 常见错误码

| 错误码 | 含义 | 解决方案 |
|--------|------|----------|
| 401 | 未授权 | 检查 API 密钥是否正确 |
| 403 | 权限不足 | 确认 API 密钥权限 |
| 429 | 速率限制 | 降低请求频率或升级计划 |
| 500 | 服务器错误 | 稍后重试或联系支持 |
| 503 | 服务不可用 | 检查服务状态页面 |

### 连接问题

**症状**: API 调用超时或连接失败
**解决方案**:
1. 检查网络连接
2. 验证 API 端点 URL
3. 设置合理的超时时间
4. 实现重试机制

```python
# 示例：带重试的请求
import requests
import time
from requests.adapters import HTTPAdapter
from urllib3.util.retry import Retry

# 配置重试策略
retry_strategy = Retry(
    total=3,
    backoff_factor=1,
    status_forcelist=[429, 500, 502, 503, 504]
)

adapter = HTTPAdapter(max_retries=retry_strategy)
session = requests.Session()
session.mount("https://", adapter)

# 发送请求
response = session.post(
    'https://api.aihub.com/api/v1/chat/completions',
    headers=headers,
    json={'message': '测试消息', 'model': 'gpt-4o-mini'}
)
```

### 性能问题

**症状**: 响应时间过长
**解决方案**:
1. 使用更快的模型（如 gpt-4o-mini）
2. 减少 max_tokens 设置
3. 使用流式响应
4. 优化网络连接

### 数据问题

**症状**: 会话数据丢失或不一致
**解决方案**:
1. 确保使用正确的 session_id
2. 检查会话是否已过期
3. 验证数据格式
4. 联系技术支持

### 获取帮助

如果以上解决方案无法解决您的问题，请通过以下方式获取帮助：

- **技术支持**: support@aihub.com
- **社区论坛**: https://community.aihub.com
- **文档中心**: https://docs.aihub.com
- **状态页面**: https://status.aihub.com

**反馈问题时请提供**:
- 您的账户信息
- 错误发生的时间
- 具体的错误信息
- 相关的请求参数
- 预期的行为结果

---

感谢您使用 AI Hub 平台！我们会持续改进产品和服务，为您提供更好的 AI 体验。