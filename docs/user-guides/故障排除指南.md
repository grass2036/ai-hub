# AI Hub Platform 故障排除指南

> 常见问题解决方案和技术��题排查方法

## 🔍 快速诊断

### 第一步：检查服务状态

在报告问题之前，请先检查服务状态：

**🌐 状态页面**
- 网址: https://status.aihub.com
- 查看实时服务状态和历史数据

**📱 官方社交媒体**
- Twitter: @AIHubPlatform
- 关注获取服务中断通知

### 第二步：本地诊断

**基础检查清单：**
- [ ] 网络连接正常
- [ ] API密钥有效且未过期
- [ ] 配额未超限
- [ ] SDK版本为最新
- [ ] 代码语法正确

## 🔑 认证问题

### API密钥无效

**错误信息：**
```
401 Unauthorized - Invalid API key
```

**可能原因：**
1. API密钥错误或拼写错误
2. API密钥已过期
3. API密钥已禁用
4. 账户未激活

**解决方案：**

1. **检查API密钥**
```bash
# 验证API密钥格式
echo "ahub_dev_xxxxxxxxxxxxxx" | grep -E "^ahub_dev_[a-zA-Z0-9_-]+$"
```

2. **获取新的API密钥**
```bash
# 通过控制台获取新密钥
curl -X POST "https://api.aihub.com/api/v1/developer/keys" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"name": "test-key", "permissions": ["chat.completions"]}'
```

3. **检查账户状态**
```bash
# 查看账户信息
curl -X GET "https://api.aihub.com/api/v1/developer/auth/me" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

### 权限不足

**错误信息：**
```
403 Forbidden - Insufficient permissions
```

**解决方案：**
1. 检查API密钥权限设置
2. 确认订阅套餐允许访问对应功能
3. 联系技术支持升级权限

## 🚫 速率限制

### 请求频率超限

**错误信息：**
```
429 Too Many Requests - Rate limit exceeded
```

**可能原因：**
1. 请求频率超过限制
2. 配额已用完
3. 并发请求过多

**解决方案：**

1. **查看速率限制**
```bash
# 查看当前配额
curl -X GET "https://api.aihub.com/api/v1/developer/quota" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

2. **实现指数退避**
```python
import time
import random

def exponential_backoff_request(url, max_retries=3):
    for attempt in range(max_retries):
        try:
            response = requests.get(url, headers=headers)
            response.raise_for_status()
            return response
        except requests.exceptions.HTTPError as e:
            if e.response.status_code == 429:
                wait_time = (2 ** attempt) + random.uniform(0, 1)
                time.sleep(wait_time)
            else:
                raise
```

3. **批量请求优化**
```python
import asyncio
import aiohttp

async def batch_requests_with_semaphore(urls, max_concurrent=10):
    semaphore = asyncio.Semaphore(max_concurrent)

    async def fetch(session, url):
        async with semaphore:
            async with session.get(url) as response:
                return await response.json()

    async with aiohttp.ClientSession() as session:
        tasks = [fetch(session, url) for url in urls]
        return await asyncio.gather(*tasks)
```

## 📦 配额问题

### 配额不足

**错误信息：**
```
403 Forbidden - Insufficient quota
```

**解决方案：**

1. **查看配额使用情况**
```bash
# 查看详细配额信息
curl -X GET "https://api.aihub.com/api/v1/developer/usage" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

2. **优化代码使用**
```python
# 使用流式响应减少token使用
import openai

response = openai.chat.completions.create(
    model="gpt-4o-mini",
    messages=[{"role": "user", "content": message}],
    stream=True,  # 流式响应减少内存使用
    max_tokens=500,  # 限制响应长度
    temperature=0.7
)

for chunk in response:
    if chunk.choices[0].delta.content is not None:
        print(chunk.choices[0].delta.content, end="")
```

3. **升级套餐**
- 登录控制台查看升级选项
- 联系销售获取企业方案

## 🌐 网络问题

### 连接超时

**错误信息：**
```
Connection timeout
```

**解决方案：**

1. **检查网络连接**
```bash
# 测试基本连接
ping api.aihub.com

# 测试端口连通性
telnet api.aihub.com 443

# 检查DNS解析
nslookup api.aihub.com
```

2. **调整超时设置**
```python
import requests

# 增加超时时间
response = requests.get(
    url,
    headers=headers,
    timeout=(10, 30)  # 连接超时10秒，读取超时30秒
)
```

3. **配置代理**
```python
import requests

proxies = {
    'http': 'http://your-proxy:port',
    'https': 'https://your-proxy:port',
}

response = requests.get(url, proxies=proxies)
```

### SSL证书问题

**错误信息：**
```
SSL: CERTIFICATE_VERIFY_FAILED
```

**解决方案：**

1. **更新证书**
```bash
# 更新系统证书
sudo apt-get update && sudo apt-get install ca-certificates

# 对于Python，更新certifi
pip install --upgrade certifi
```

2. **临时跳过验证（仅测试用）**
```python
import urllib3
import requests

# 禁用SSL警告（仅测试环境）
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

# 跳过SSL验证
response = requests.get(url, verify=False)
```

## 💻 SDK问题

### Python SDK

#### 安装失败

**错误信息：**
```
ERROR: Could not install packages due to an EnvironmentError
```

**解决方案：**
```bash
# 升级pip
python -m pip install --upgrade pip

# 清理缓存
pip cache purge

# 使用国内镜像
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple ai-hub-python
```

#### 导入错误

**错误信息：**
```
ModuleNotFoundError: No module named 'ai_hub'
```

**解决方案：**
```python
# 检查安装位置
pip show ai-hub-python

# 确认Python路径
which python
python -c "import sys; print(sys.path)"

# 重新安装
pip uninstall ai-hub-python
pip install ai-hub-python
```

### JavaScript SDK

#### npm安装失败

**错误信息：**
```
npm ERR! code ERESOLVE
```

**解决方案：**
```bash
# 清理npm缓存
npm cache clean --force

# 删除node_modules和package-lock.json
rm -rf node_modules package-lock.json

# 使用--legacy-peer-deps
npm install @ai-hub/javascript --legacy-peer-deps

# 或使用yarn
yarn add @ai-hub/javascript
```

#### 模块导入错误

**错误信息：**
```
Uncaught ReferenceError: module is not defined
```

**解决方案：**
```javascript
// 检查环境支持
if (typeof module === 'undefined' && typeof window !== 'undefined') {
    // 浏览器环境
    import { AIHubClient } from '@ai-hub/javascript';
} else {
    // Node.js环境
    const { AIHubClient } = require('@ai-hub/javascript');
}

// 或者使用动态导入
const { AIHubClient } = await import('@ai-hub/javascript');
```

## 🔧 调试技巧

### 启用调试日志

**Python SDK**
```python
import logging
import ai_hub

# 启用调试日志
logging.basicConfig(level=logging.DEBUG)

# 创建客户端时启用调试
client = ai_hub.AIHubClient(
    api_key="your_key",
    debug=True  # 启用调试模式
)
```

**JavaScript SDK**
```javascript
// 启用调试模式
const client = new AIHubClient({
    apiKey: 'your_key',
    debug: true
});

// 监听所有事件
client.on('debug', (event) => {
    console.log('Debug:', event);
});
```

### 捕获请求详情

**Python**
```python
import requests
import json
from requests.packages.urllib3.exceptions import InsecureRequestWarning

# 请求拦截器
class RequestLogger:
    def __init__(self):
        self.requests = []

    def log_request(self, request, response):
        self.requests.append({
            'url': request.url,
            'method': request.method,
            'headers': dict(request.headers),
            'response_code': response.status_code,
            'response_body': response.text
        })

# 使用requests hooks
def log_response(response, *args, **kwargs):
    print(f"Response: {response.status_code} - {response.url}")
    print(f"Headers: {response.headers}")
    return response

session = requests.Session()
session.hooks['response'].append(log_response)
```

**JavaScript**
```javascript
// 使用fetch拦截器
const originalFetch = window.fetch;

window.fetch = async (...args) => {
    const [url, options] = args;
    console.log('Request:', { url, options });

    const response = await originalFetch(...args);
    console.log('Response:', {
        status: response.status,
        headers: response.headers,
        url: response.url
    });

    return response;
};
```

## 📊 性能问题

### 响应时间慢

**诊断步骤：**

1. **基准测试**
```python
import time
import requests

def benchmark_request():
    start_time = time.time()
    response = requests.get(url, headers=headers)
    end_time = time.time()

    print(f"Request time: {end_time - start_time:.2f}s")
    print(f"Status: {response.status_code}")
    return response

# 多次测试取平均值
times = []
for i in range(10):
    start = time.time()
    benchmark_request()
    times.append(time.time() - start)

print(f"Average response time: {sum(times)/len(times):.2f}s")
```

2. **性能优化建议**
- 使用流式响应
- 实现请求缓存
- 优化请求参数
- 选择合适的模型

### 内存使用高

**监控方法：**
```python
import psutil
import os

def monitor_memory():
    process = psutil.Process(os.getpid())
    memory_info = process.memory_info()

    print(f"Memory usage: {memory_info.rss / 1024 / 1024:.2f} MB")
    print(f"Memory percent: {process.memory_percent()}%")

# 在关键位置调用监控
monitor_memory()
```

## 🆘 获取更多帮助

### 联系技术支持

如果以上解决方案无法解决您的问题，请：

1. **收集信息**
   - 错误消息的完整内容
   - 请求和响应的详细信息
   - 重现步骤
   - 环境信息（操作系统、SDK版本等）

2. **提交报告**
   - GitHub Issues: https://github.com/ai-hub/platform/issues
   - 技术支持邮件: support@aihub.com
   - 开发者社区: https://community.aihub.com

3. **实时支持**
   - Discord: https://discord.gg/aihub
   - 企业支持: urgent@aihub.com

### 常用命令行工具

```bash
# 测试API连通性
curl -v "https://api.aihub.com/api/v1/models" \
  -H "Authorization: Bearer YOUR_API_KEY"

# 检查DNS解析
dig api.aihub.com

# 网络诊断
traceroute api.aihub.com

# 端口扫描
nmap -p 443 api.aihub.com
```

---

希望这个故障排除指南能帮助您快速解决问题。如需更多帮助，请随时联系我们的技术支持团队！