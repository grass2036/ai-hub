# 美洲区域部署配置
# Americas Regional Deployment Configuration

region:
  name: "americas"
  display_name: "Americas"
  code: "amr"

# 数据中心配置
datacenters:
  # 主要数据中心 - 北弗吉尼亚
  primary:
    name: "North Virginia"
    code: "us-va-1"
    location: "Northern Virginia, USA"
    provider: "AWS"
    region: "us-east-1"
    availability_zones: ["us-east-1a", "us-east-1b", "us-east-1c", "us-east-1d"]

  # 次要数据中心 - 俄勒冈
  secondary:
    name: "Oregon"
    code: "us-or-1"
    location: "Oregon, USA"
    provider: "AWS"
    region: "us-west-2"
    availability_zones: ["us-west-2a", "us-west-2b", "us-west-2c"]

  # 边缘数据中心 - 加拿大
  edge:
    name: "Toronto"
    code: "ca-on-1"
    location: "Toronto, Canada"
    provider: "AWS"
    region: "ca-central-1"
    availability_zones: ["ca-central-1a", "ca-central-1b"]

  # 拉丁美洲数据中心 - 圣保罗
  latam:
    name: "São Paulo"
    code: "br-sp-1"
    location: "São Paulo, Brazil"
    provider: "AWS"
    region: "sa-east-1"
    availability_zones: ["sa-east-1a", "sa-east-1b", "sa-east-1c"]

# 网络配置
networking:
  cdn:
    provider: "Cloudflare"
    distribution_types:
      - "static"    # 静态资源CDN
      - "api"       # API请求CDN
      - "streaming" # 实时流媒体CDN
      - "video"     # 视频点播CDN

  load_balancer:
    type: "Application Load Balancer"
    algorithm: "least_connections"
    health_check:
      path: "/health"
      interval: 30
      timeout: 5
      healthy_threshold: 2
      unhealthy_threshold: 3

  dns:
    provider: "Route53"
    routing_policy: "geolocation"
    records:
      - type: "A"
        ttl: 60
        geo_location: "United States"
      - type: "A"
        ttl: 60
        geo_location: "Canada"
      - type: "A"
        ttl: 60
        geo_location: "South America"

# 数据库配置
database:
  primary:
    engine: "PostgreSQL"
    version: "15.4"
    instance_class: "db.r6g.4xlarge"
    multi_az: true
    storage_type: "io1"
    allocated_storage: 2000
    iops: 30000
    backup_retention: 30
    backup_window: "03:00-04:00"
    maintenance_window: "sun:04:00-sun:05:00"

  read_replicas:
    - region: "us-east-1"
      instance_class: "db.r6g.2xlarge"
    - region: "us-west-2"
      instance_class: "db.r6g.2xlarge"
    - region: "ca-central-1"
      instance_class: "db.r6g.xlarge"
    - region: "sa-east-1"
      instance_class: "db.r6g.xlarge"

  cache:
    engine: "Redis"
    version: "7.0"
    node_type: "cache.r6g.4xlarge"
    cluster_mode: true
    num_cache_nodes: 5
    automatic_failover: true

  global_database:
    enabled: true
    primary_region: "us-east-1"
    secondary_regions:
      - "us-west-2"
      - "ca-central-1"

# 容器编排
kubernetes:
  version: "1.28"
  node_groups:
    - name: "system"
      instance_types: ["m6g.large", "m6g.xlarge", "m6g.2xlarge"]
      min_size: 3
      max_size: 6
      desired_size: 4
      disk_size: 50

    - name: "application"
      instance_types: ["c6g.2xlarge", "c6g.4xlarge", "c6g.8xlarge"]
      min_size: 5
      max_size: 15
      desired_size: 8
      disk_size: 100

    - name: "batch"
      instance_types: ["r6g.4xlarge", "r6g.8xlarge", "r6g.12xlarge"]
      min_size: 2
      max_size: 8
      desired_size: 3
      disk_size: 200

    - name: "gpu"
      instance_types: ["p4d.24xlarge", "p3.8xlarge"]
      min_size: 0
      max_size: 4
      desired_size: 1
      disk_size: 1000
      gpu_required: true

# 监控和日志
monitoring:
  metrics:
    prometheus:
      retention: "45d"
      scrape_interval: "10s"

  logs:
    elasticsearch:
      retention: "120d"
      shard_count: 8
      replica_count: 2

  tracing:
    jaeger:
      retention: "14d"
      sampling_rate: 0.15

# 安全配置
security:
  ssl_certificates:
    provider: "AWS Certificate Manager"
    certificate_arn: "arn:aws:acm:us-east-1:123456789012:certificate/12345678-1234-1234-1234-123456789012"

  waf:
    provider: "AWS WAF"
    rules:
      - name: "SQLInjection"
        action: "block"
      - name: "XSS"
        action: "block"
      - name: "RateLimit"
        action: "throttle"
        rate_limit: 2000
      - name: "GeoBlocking"
        action: "allow"
        allowed_countries: ["US", "CA", "BR", "MX", "AR"]

  network_security:
    vpc_cidr: "10.2.0.0/16"
    public_subnets: ["10.2.1.0/24", "10.2.2.0/24", "10.2.3.0/24"]
    private_subnets: ["10.2.11.0/24", "10.2.12.0/24", "10.2.13.0/24"]
    database_subnets: ["10.2.21.0/24", "10.2.22.0/24", "10.2.23.0/24"]

# 数据合规性
compliance:
  data_residency: "flexible"
  encryption_at_rest: true
  encryption_in_transit: true
  audit_logging: true

  local_regulations:
    - country: "United States"
      acts: ["California Consumer Privacy Act (CCPA)", "Health Insurance Portability and Accountability Act (HIPAA)"]
      data_residency: false
      consent_required: true
      sector_specific: true

    - country: "Canada"
      acts: ["Personal Information Protection and Electronic Documents Act (PIPEDA)"]
      data_residency: true
      consent_required: true

    - country: "Brazil"
      acts: ["Lei Geral de Proteção de Dados (LGPD)"]
      data_residency: true
      consent_required: true

    - country: "Mexico"
      acts: ["Ley Federal de Protección de Datos Personales en Posesión de los Particulares"]
      data_residency: false
      consent_required: true

  # 美国特定合规要求
  us_compliance:
    hipaa:
      enabled: true
      business_associate_agreement: true
      audit_controls: true
      access_controls: true

    ccpa:
      enabled: true
      right_to_know: true
      right_to_delete: true
      right_to_opt_out: true
      non_discrimination: true

# 自动扩展
auto_scaling:
  web_servers:
    min_capacity: 5
    max_capacity: 30
    target_cpu_utilization: 55
    target_memory_utilization: 65
    scale_up_cooldown: 240
    scale_down_cooldown: 300

  api_servers:
    min_capacity: 3
    max_capacity: 20
    target_cpu_utilization: 45
    target_memory_utilization: 60
    scale_up_cooldown: 120
    scale_down_cooldown: 240

  gpu_workers:
    min_capacity: 0
    max_capacity: 10
    target_gpu_utilization: 80
    scale_up_cooldown: 180
    scale_down_cooldown: 300

# 备份和灾难恢复
backup:
  automated_backups:
    - service: "database"
      schedule: "0 4 * * *"  # 每天凌晨4点
      retention_days: 60
      cross_region: true
      cross_region_replication: "us-west-2"

    - service: "file_storage"
      schedule: "0 3 * * 0"  # 每周日凌晨3点
      retention_days: 120
      cross_region: true
      cross_region_replication: "us-west-2"

    - service: "user_data"
      schedule: "0 5 * * *"  # 每天凌晨5点
      retention_days: 2555  # 7年
      cross_region: true
      cross_region_replication: "us-west-2"
      immutable: true

  disaster_recovery:
    rto: "1h"  # Recovery Time Objective (最严格)
    rpo: "5m"  # Recovery Point Objective (最严格)
    failover: "automatic"
    testing_frequency: "monthly"

# 成本优化
cost_optimization:
  reserved_instances:
    - instance_type: "db.r6g.4xlarge"
      term: "3-year"
      payment: "all_upfront"
      quantity: 2

    - instance_type: "cache.r6g.4xlarge"
      term: "3-year"
      payment: "partial_upfront"
      quantity: 3

  spot_instances:
    enabled: true
    max_percentage: 40
    fallback_on_demand: true

  savings_plans:
    compute_savings_plan:
      commitment: "$10000"
      term: "3-year"
      payment: "partial_upfront"